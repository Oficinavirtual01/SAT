<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SAT – Alertas</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  html, body, #map { height:100%; margin:0; }
  .panel { position:absolute; top:12px; left:12px; z-index:9999; background:rgba(255,255,255,.95);
           padding:10px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.2);
           font:14px system-ui,-apple-system, Segoe UI, Roboto, sans-serif; width:320px; }
  .panel h3{ margin:0 0 8px; font-size:16px; }
  .panel label{ display:block; margin:6px 0 2px; font-weight:600; }
  .legend{ position:absolute; bottom:12px; left:12px; background:rgba(255,255,255,.9); padding:6px 8px; border-radius:8px; font-size:12px; }
  .rowBtns{ margin-top:8px; display:flex; gap:6px; flex-wrap:wrap; }
  .btn{ display:inline-block; padding:6px 10px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer; }
  .btn:hover{ background:#f2f2f2; }
  .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-weight:600; font-size:12px; }
  .pill.alta  { background:#eaf5ea; color:#2e7d32; border:1px solid #2e7d32; }
  .pill.media { background:#fff7e0; color:#f9a825; border:1px solid #f9a825; }
  .pill.baja  { background:#fdeaea; color:#c62828; border:1px solid #c62828; }
</style>
</head>
<body>
<div id="map"></div>

<div class="panel">
  <h3>Filtros SAT</h3>

  <label for="fComisaria">Comisaría</label>
  <select id="fComisaria"><option value="">(Todas)</option></select>

  <label for="fDistrito">Distrito</label>
  <select id="fDistrito"><option value="">(Todos)</option></select>

  <label for="fDia">Día</label>
  <select id="fDia"><option value="">(Todos)</option></select>

  <label for="fFranja">Franja</label>
  <select id="fFranja"><option value="">(Todas)</option></select>

  <label for="fConf">Confiabilidad mínima</label>
  <input type="range" id="fConf" min="0" max="100" value="0" step="1"/>
  <div><span id="confVal">0</span></div>

  <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap;">
    <label><input type="checkbox" id="layerPuntos" checked/> Centroides</label>
    <label><input type="checkbox" id="layerPolys" checked/> Polígonos</label>
    <label><input type="checkbox" id="layerHeat"  /> Heatmap</label>
  </div>

  <div class="rowBtns">
    <button class="btn" id="btnFit">Ajustar vista</button>
  </div>

  <div style="margin-top:10px">
    <b>Referencia de confiabilidad:</b><br/>
    <span class="pill alta">Alta</span>
    <span class="pill media">Media</span>
    <span class="pill baja">Baja</span>
  </div>
</div>

<div class="legend">
  <b>Confiabilidad</b>:
  <span style="color:#2e7d32">Alta</span> /
  <span style="color:#f9a825">Media</span> /
  <span style="color:#c62828">Baja</span>
</div>

<!-- Datos embebidos -->
<script>
  const GJ_POINTS = {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.84650233333333,-32.88544866666667]},"properties":{"alerta_id":"ALR_450m_05/08/2025_-32.88545_-68.84650_3 // Zona 25 de Mayo","human_id":"ALR1_450m_Tue Aug 05_3ev — 25 de Mayo","fecha":"Tue Aug 05 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Martes","dia_label":"Martes (67%)","franja":"Madrugada","franja_label":"Madrugada (67%)","rango_horario":"00:01–12:50","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Hurto×1 | Av. Robo×1 | Av. Robo Agravado por el uso de arma de Fuego×1","delito_dom":"Av. Robo Agravado por el uso de arma de Fuego","comisaria":"Cria__1","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":36,"conf_label":"Baja (disperso o baja frecuencia)","zona":"25 de Mayo","calles":"Necochea 661 / Julio Leónidas Aguirre 67 / Avenida Las Heras 359"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.83982544444444,-32.88726233333333]},"properties":{"alerta_id":"ALR_450m_08/08/2025_-32.88726_-68.83983_9 // Zona 9 de Julio","human_id":"ALR2_450m_Fri Aug 08_9ev — 9 de Julio","fecha":"Fri Aug 08 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Viernes","dia_label":"Viernes (33%)","franja":"Tarde","franja_label":"Tarde (44%)","rango_horario":"19:25–20:20","radio_m":450,"n_eventos":9,"delitos_comp":"Av. Hurto×8 | Av. Hurto EGT×1","delito_dom":"Av. Hurto","comisaria":"Cria__1","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":45,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"9 de Julio","calles":"Avenida San Martín 1187 / General Espejo 151 / Necochea 150 / General Paz 237 / Avenida Las Heras 209 / San Juan 1211 / San Juan 1499 / Avenida España 1401"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.84156533333334,-32.87227]},"properties":{"alerta_id":"ALR_450m_08/08/2025_-32.87227_-68.84157_3 // Zona Chile","human_id":"ALR3_450m_Fri Aug 08_3ev — Chile","fecha":"Fri Aug 08 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Viernes","dia_label":"Viernes (67%)","franja":"Tarde","franja_label":"Tarde (33%)","rango_horario":"21:50–07:45","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Hurto×2 | Av. Robo×1","delito_dom":"Av. Hurto","comisaria":"Cria__4","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":44,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Chile","calles":"Fray Inalican 353 / El Parral 2440 / Videla Correa 628"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.83700066666667,-32.87977466666666]},"properties":{"alerta_id":"ALR_450m_06/08/2025_-32.87977_-68.83700_3 // Zona Avenida San Martín","human_id":"ALR4_450m_Wed Aug 06_3ev — Avenida San Martín","fecha":"Wed Aug 06 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Martes","dia_label":"Martes (33%)","franja":"Tarde","franja_label":"Tarde (67%)","rango_horario":"15:50–10:20","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo×2 | Av. Hurto×1","delito_dom":"Av. Robo","comisaria":"Cria__1","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":43,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Avenida San Martín","calles":"Avenida San Martín 2097 / Juan B. Alberdi 51 / Avenida España 1927"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.840239,-32.8933045]},"properties":{"alerta_id":"ALR_450m_08/08/2025_-32.89330_-68.84024_4 // Zona Avenida San Martín","human_id":"ALR5_450m_Fri Aug 08_4ev — Avenida San Martín","fecha":"Fri Aug 08 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Viernes","dia_label":"Viernes (50%)","franja":"Noche","franja_label":"Noche (75%)","rango_horario":"19:30–23:15","radio_m":450,"n_eventos":4,"delitos_comp":"Av. Hurto Agravado×2 | Av. Hurto×1 | Av. Robo×1","delito_dom":"Av. Hurto Agravado","comisaria":"Cria__2","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":53,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Avenida San Martín","calles":"Avenida España 920 / L. N. Alem 100 / 9 de Julio 712 / Primitivo de la Reta 923"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.83534166666665,-32.865338]},"properties":{"alerta_id":"ALR_450m_06/08/2025_-32.86534_-68.83534_3 // Zona Avenida España","human_id":"ALR6_450m_Wed Aug 06_3ev — Avenida España","fecha":"Wed Aug 06 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Martes","dia_label":"Martes (33%)","franja":"Noche","franja_label":"Noche (67%)","rango_horario":"21:45–21:20","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo Agravado por el uso de arma de Fuego×2 | Av. Robo Agravado×1","delito_dom":"Av. Robo Agravado por el uso de arma de Fuego","comisaria":"Cria__4","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":48,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Avenida España","calles":"José Manuel Estrada 237 / José Manuel Estrada 192 / 9 de Julio 3104"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.83463366666668,-32.872643000000004]},"properties":{"alerta_id":"ALR_450m_08/08/2025_-32.87264_-68.83463_3 // Zona Avenida San Martín","human_id":"ALR7_450m_Fri Aug 08_3ev — Avenida San Martín","fecha":"Fri Aug 08 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Jueves","dia_label":"Jueves (33%)","franja":"Noche","franja_label":"Noche (67%)","rango_horario":"20:35–01:00","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo×1 | Av. Robo Agravado×1 | Av. Robo agravado EGT×1","delito_dom":"Av. Robo agravado EGT","comisaria":"Cria__4","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":41,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Avenida San Martín","calles":"Echeverría 27 / Ayacucho 198 / Echeverría 63"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.85668100000001,-32.89645325]},"properties":{"alerta_id":"ALR_450m_09/08/2025_-32.89645_-68.85668_4 // Zona Martínez de Rozas","human_id":"ALR8_450m_Sat Aug 09_4ev — Martínez de Rozas","fecha":"Sat Aug 09 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Viernes","dia_label":"Viernes (25%)","franja":"Tarde","franja_label":"Tarde (50%)","rango_horario":"17:05–15:20","radio_m":450,"n_eventos":4,"delitos_comp":"Av. Hurto×1 | Av. Hurto Agravado×1 | Av. Robo×1 | Av. Robo Agravado×1","delito_dom":"Av. Hurto Agravado","comisaria":"Cria__5","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":51,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Martínez de Rozas","calles":"Coronel Rodríguez 240 / Sobremonte 502 / Vicente Gil 505 / J. y M. Clark 386"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.86212566666667,-32.89785966666667]},"properties":{"alerta_id":"ALR_450m_07/08/2025_-32.89786_-68.86213_3 // Zona Emilio Jofré","human_id":"ALR9_450m_Thu Aug 07_3ev — Emilio Jofré","fecha":"Thu Aug 07 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Jueves","dia_label":"Jueves (67%)","franja":"Noche","franja_label":"Noche (67%)","rango_horario":"22:50–18:30","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Hurto×1 | Av. Robo×1 | Av. Robo Agravado×1","delito_dom":"Av. Robo","comisaria":"Cria__5","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":46,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Emilio Jofré","calles":"Lamadrid 699 / Pueyrredón 812 / B Sur Mer 361"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.8644685,-32.903421249999994]},"properties":{"alerta_id":"ALR_450m_06/08/2025_-32.90342_-68.86447_4 // Zona Méjico","human_id":"ALR10_450m_Wed Aug 06_4ev — Méjico","fecha":"Wed Aug 06 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Miércoles","dia_label":"Miércoles (50%)","franja":"Noche","franja_label":"Noche (50%)","rango_horario":"00:30–11:18","radio_m":450,"n_eventos":4,"delitos_comp":"Av. Hurto Agravado×2 | Av. Robo Agravado×1 | Av. Robo EGT×1","delito_dom":"Av. Hurto Agravado","comisaria":"Cria_27","distrito":"Godoy Cruz","link_gmaps":"Ver Mapa patrullaje","confiabilidad":43,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Méjico","calles":"Boulogne Sur Mer 1710 / Santiago del Estero 2058 / Colombia 1604 / Pedro J. Godoy 1664"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.848525,-32.909649333333334]},"properties":{"alerta_id":"ALR_450m_06/08/2025_-32.90965_-68.84852_3 // Zona Biritos","human_id":"ALR11_450m_Wed Aug 06_3ev — Biritos","fecha":"Wed Aug 06 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Sábado","dia_label":"Sábado (33%)","franja":"Madrugada","franja_label":"Madrugada (67%)","rango_horario":"02:50–02:30","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo×2 | Av. Hurto Agravado×1","delito_dom":"Av. Robo","comisaria":"Cria_34","distrito":"Godoy Cruz","link_gmaps":"Ver Mapa patrullaje","confiabilidad":49,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Biritos","calles":"Pasaje Salinas 1331 / Echeverría 1554 / Maipú 235"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-68.82006033333333,-32.944426666666665]},"properties":{"alerta_id":"ALR_450m_11/08/2025_-32.94443_-68.82006_3 // Zona Azul","human_id":"ALR12_450m_Mon Aug 11_3ev — Azul","fecha":"Mon Aug 11 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Sábado","dia_label":"Sábado (33%)","franja":"Tarde","franja_label":"Tarde (67%)","rango_horario":"13:45–20:00","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo×2 | Av. Hurto Agravado×1","delito_dom":"Av. Robo","comisaria":"Cria_37","distrito":"Godoy Cruz","link_gmaps":"Ver Mapa patrullaje","confiabilidad":46,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Azul","calles":"Sarmiento 2181 / Arrecifes 1347 / Azul 1183"}}]};
  const GJ_POLYS  = {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.849963,-32.885182],[-68.846884,-32.885925],[-68.84266,-32.885239],[-68.849963,-32.885182]]]},"properties":{"alerta_id":"ALR_450m_05/08/2025_-32.88545_-68.84650_3 // Zona 25 de Mayo","human_id":"ALR1_450m_Tue Aug 05_3ev — 25 de Mayo","fecha":"Tue Aug 05 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Martes","dia_label":"Martes (67%)","franja":"Madrugada","franja_label":"Madrugada (67%)","rango_horario":"00:01–12:50","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Hurto×1 | Av. Robo×1 | Av. Robo Agravado por el uso de arma de Fuego×1","delito_dom":"Av. Robo Agravado por el uso de arma de Fuego","comisaria":"Cria__1","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":36,"conf_label":"Baja (disperso o baja frecuencia)","zona":"25 de Mayo","calles":"Necochea 661 / Julio Leónidas Aguirre 67 / Avenida Las Heras 359"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.841237,-32.886994],[-68.840844,-32.889167],[-68.838953,-32.889725],[-68.837009,-32.889587],[-68.83673,-32.886023],[-68.840867,-32.884357],[-68.841049,-32.885646],[-68.841237,-32.886994]]]},"properties":{"alerta_id":"ALR_450m_08/08/2025_-32.88726_-68.83983_9 // Zona 9 de Julio","human_id":"ALR2_450m_Fri Aug 08_9ev — 9 de Julio","fecha":"Fri Aug 08 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Viernes","dia_label":"Viernes (33%)","franja":"Tarde","franja_label":"Tarde (44%)","rango_horario":"19:25–20:20","radio_m":450,"n_eventos":9,"delitos_comp":"Av. Hurto×8 | Av. Hurto EGT×1","delito_dom":"Av. Hurto","comisaria":"Cria__1","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":45,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"9 de Julio","calles":"Avenida San Martín 1187 / General Espejo 151 / Necochea 150 / General Paz 237 / Avenida Las Heras 209 / San Juan 1211 / San Juan 1499 / Avenida España 1401"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.843048,-32.870485],[-68.842455,-32.874305],[-68.839193,-32.87202],[-68.843048,-32.870485]]]},"properties":{"alerta_id":"ALR_450m_08/08/2025_-32.87227_-68.84157_3 // Zona Chile","human_id":"ALR3_450m_Fri Aug 08_3ev — Chile","fecha":"Fri Aug 08 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Viernes","dia_label":"Viernes (67%)","franja":"Tarde","franja_label":"Tarde (33%)","rango_horario":"21:50–07:45","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Hurto×2 | Av. Robo×1","delito_dom":"Av. Hurto","comisaria":"Cria__4","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":44,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Chile","calles":"Fray Inalican 353 / El Parral 2440 / Videla Correa 628"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.839441,-32.880787],[-68.835636,-32.879821],[-68.835925,-32.878716],[-68.839441,-32.880787]]]},"properties":{"alerta_id":"ALR_450m_06/08/2025_-32.87977_-68.83700_3 // Zona Avenida San Martín","human_id":"ALR4_450m_Wed Aug 06_3ev — Avenida San Martín","fecha":"Wed Aug 06 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Martes","dia_label":"Martes (33%)","franja":"Tarde","franja_label":"Tarde (67%)","rango_horario":"15:50–10:20","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo×2 | Av. Hurto×1","delito_dom":"Av. Robo","comisaria":"Cria__1","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":43,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Avenida San Martín","calles":"Avenida San Martín 2097 / Juan B. Alberdi 51 / Avenida España 1927"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.842529,-32.892172],[-68.841845,-32.894584],[-68.838421,-32.893347],[-68.838161,-32.893115],[-68.842529,-32.892172]]]},"properties":{"alerta_id":"ALR_450m_08/08/2025_-32.89330_-68.84024_4 // Zona Avenida San Martín","human_id":"ALR5_450m_Fri Aug 08_4ev — Avenida San Martín","fecha":"Fri Aug 08 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Viernes","dia_label":"Viernes (50%)","franja":"Noche","franja_label":"Noche (75%)","rango_horario":"19:30–23:15","radio_m":450,"n_eventos":4,"delitos_comp":"Av. Hurto Agravado×2 | Av. Hurto×1 | Av. Robo×1","delito_dom":"Av. Hurto Agravado","comisaria":"Cria__2","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":53,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Avenida San Martín","calles":"Avenida España 920 / L. N. Alem 100 / 9 de Julio 712 / Primitivo de la Reta 923"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.836013,-32.86436],[-68.834593,-32.866781],[-68.835419,-32.864873],[-68.836013,-32.86436]]]},"properties":{"alerta_id":"ALR_450m_06/08/2025_-32.86534_-68.83534_3 // Zona Avenida España","human_id":"ALR6_450m_Wed Aug 06_3ev — Avenida España","fecha":"Wed Aug 06 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Martes","dia_label":"Martes (33%)","franja":"Noche","franja_label":"Noche (67%)","rango_horario":"21:45–21:20","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo Agravado por el uso de arma de Fuego×2 | Av. Robo Agravado×1","delito_dom":"Av. Robo Agravado por el uso de arma de Fuego","comisaria":"Cria__4","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":48,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Avenida España","calles":"José Manuel Estrada 237 / José Manuel Estrada 192 / 9 de Julio 3104"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.835361,-32.871304],[-68.83356,-32.875105],[-68.83498,-32.87152],[-68.835361,-32.871304]]]},"properties":{"alerta_id":"ALR_450m_08/08/2025_-32.87264_-68.83463_3 // Zona Avenida San Martín","human_id":"ALR7_450m_Fri Aug 08_3ev — Avenida San Martín","fecha":"Fri Aug 08 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Jueves","dia_label":"Jueves (33%)","franja":"Noche","franja_label":"Noche (67%)","rango_horario":"20:35–01:00","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo×1 | Av. Robo Agravado×1 | Av. Robo agravado EGT×1","delito_dom":"Av. Robo agravado EGT","comisaria":"Cria__4","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":41,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Avenida San Martín","calles":"Echeverría 27 / Ayacucho 198 / Echeverría 63"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.85811,-32.896865],[-68.854079,-32.897892],[-68.857072,-32.895152],[-68.85811,-32.896865]]]},"properties":{"alerta_id":"ALR_450m_09/08/2025_-32.89645_-68.85668_4 // Zona Martínez de Rozas","human_id":"ALR8_450m_Sat Aug 09_4ev — Martínez de Rozas","fecha":"Sat Aug 09 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Viernes","dia_label":"Viernes (25%)","franja":"Tarde","franja_label":"Tarde (50%)","rango_horario":"17:05–15:20","radio_m":450,"n_eventos":4,"delitos_comp":"Av. Hurto×1 | Av. Hurto Agravado×1 | Av. Robo×1 | Av. Robo Agravado×1","delito_dom":"Av. Hurto Agravado","comisaria":"Cria__5","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":51,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Martínez de Rozas","calles":"Coronel Rodríguez 240 / Sobremonte 502 / Vicente Gil 505 / J. y M. Clark 386"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.862897,-32.896124],[-68.862605,-32.899495],[-68.860875,-32.89796],[-68.862897,-32.896124]]]},"properties":{"alerta_id":"ALR_450m_07/08/2025_-32.89786_-68.86213_3 // Zona Emilio Jofré","human_id":"ALR9_450m_Thu Aug 07_3ev — Emilio Jofré","fecha":"Thu Aug 07 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Jueves","dia_label":"Jueves (67%)","franja":"Noche","franja_label":"Noche (67%)","rango_horario":"22:50–18:30","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Hurto×1 | Av. Robo×1 | Av. Robo Agravado×1","delito_dom":"Av. Robo","comisaria":"Cria__5","distrito":"Capital","link_gmaps":"Ver Mapa patrullaje","confiabilidad":46,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Emilio Jofré","calles":"Lamadrid 699 / Pueyrredón 812 / B Sur Mer 361"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.868331,-32.901686],[-68.862133,-32.905724],[-68.863112,-32.903689],[-68.864298,-32.902586],[-68.868331,-32.901686]]]},"properties":{"alerta_id":"ALR_450m_06/08/2025_-32.90342_-68.86447_4 // Zona Méjico","human_id":"ALR10_450m_Wed Aug 06_4ev — Méjico","fecha":"Wed Aug 06 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Miércoles","dia_label":"Miércoles (50%)","franja":"Noche","franja_label":"Noche (50%)","rango_horario":"00:30–11:18","radio_m":450,"n_eventos":4,"delitos_comp":"Av. Hurto Agravado×2 | Av. Robo Agravado×1 | Av. Robo EGT×1","delito_dom":"Av. Hurto Agravado","comisaria":"Cria_27","distrito":"Godoy Cruz","link_gmaps":"Ver Mapa patrullaje","confiabilidad":43,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Méjico","calles":"Boulogne Sur Mer 1710 / Santiago del Estero 2058 / Colombia 1604 / Pedro J. Godoy 1664"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.849215,-32.909843],[-68.848275,-32.910873],[-68.848085,-32.908232],[-68.849215,-32.909843]]]},"properties":{"alerta_id":"ALR_450m_06/08/2025_-32.90965_-68.84852_3 // Zona Biritos","human_id":"ALR11_450m_Wed Aug 06_3ev — Biritos","fecha":"Wed Aug 06 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Sábado","dia_label":"Sábado (33%)","franja":"Madrugada","franja_label":"Madrugada (67%)","rango_horario":"02:50–02:30","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo×2 | Av. Hurto Agravado×1","delito_dom":"Av. Robo","comisaria":"Cria_34","distrito":"Godoy Cruz","link_gmaps":"Ver Mapa patrullaje","confiabilidad":49,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Biritos","calles":"Pasaje Salinas 1331 / Echeverría 1554 / Maipú 235"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-68.82045,-32.942862],[-68.820063,-32.94633],[-68.819668,-32.944088],[-68.82045,-32.942862]]]},"properties":{"alerta_id":"ALR_450m_11/08/2025_-32.94443_-68.82006_3 // Zona Azul","human_id":"ALR12_450m_Mon Aug 11_3ev — Azul","fecha":"Mon Aug 11 2025 00:00:00 GMT-0300 (Argentina Standard Time)","dia":"Sábado","dia_label":"Sábado (33%)","franja":"Tarde","franja_label":"Tarde (67%)","rango_horario":"13:45–20:00","radio_m":450,"n_eventos":3,"delitos_comp":"Av. Robo×2 | Av. Hurto Agravado×1","delito_dom":"Av. Robo","comisaria":"Cria_37","distrito":"Godoy Cruz","link_gmaps":"Ver Mapa patrullaje","confiabilidad":46,"conf_label":"Media (patrón moderado / posible dispersión)","zona":"Azul","calles":"Sarmiento 2181 / Arrecifes 1347 / Azul 1183"}}]};
</script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
<script>
  const map = L.map('map').setView([-32.89, -68.84], 13);
  const baseLayers = {
    "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap' }),
    "Google Maps (vial)": L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3']}),
    "Google Maps (satélite)": L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3']})
  };
  baseLayers["OpenStreetMap"].addTo(map);
  L.control.layers(baseLayers).addTo(map);

  let heat;
  const grupoPuntos = L.layerGroup().addTo(map);
  const grupoPolys  = L.layerGroup().addTo(map);
  let allFeatures = [];

  function colorByConf(c){
    if (c >= 70) return '#2e7d32';
    if (c >= 40) return '#f9a825';
    return '#c62828';
  }
  function popupHtml(p){
    const idHum = p.human_id || '';
    const idTec = p.alerta_id || '';
    const zona  = p.zona || '';
    return `<div style="min-width:260px">
      <div style="font-weight:700; font-size:14px; margin-bottom:4px">${idHum || idTec || '(sin id)'}</div>
      ${zona ? `<div style="margin-top:4px">${zona}</div>` : ''}
      <div><small>${(p.fecha||'')} — ${(p.dia_label||'')} — ${(p.franja_label||'')}</small></div>
      <div style="margin-top:6px">Eventos: <b>${p.n_eventos||0}</b> | Radio: <b>${p.radio_m||0} m</b></div>
      <div>Confiabilidad: <b>${p.confiabilidad||0}</b> <i>${p.conf_label||''}</i></div>
      ${p.delitos_comp ? `<div style="margin-top:4px">Delitos: ${p.delitos_comp}</div>` : ''}
      ${p.link_gmaps ? `<div style="margin-top:6px"><a href="${p.link_gmaps}" target="_blank">Ver recorrido en GMaps</a></div>` : ''}
    </div>`;
  }

  function buildFilters(points){
    const setCom=new Set(), setDis=new Set(), setDia=new Set(), setFra=new Set();
    for (const f of points.features){
      const p = f.properties||{};
      if (p.comisaria) setCom.add(p.comisaria);
      if (p.distrito)  setDis.add(p.distrito);
      if (p.dia)       setDia.add(p.dia);
      if (p.franja)    setFra.add(p.franja);
    }
    fillSelect('fComisaria', Array.from(setCom).sort());
    fillSelect('fDistrito',  Array.from(setDis).sort());
    fillSelect('fDia',       Array.from(setDia).sort());
    fillSelect('fFranja',    Array.from(setFra).sort());
  }
  function fillSelect(id, arr){
    const el = document.getElementById(id);
    for (const v of arr){
      const opt = document.createElement('option');
      opt.value = v; opt.textContent = v;
      el.appendChild(opt);
    }
  }
  function getFilters(){
    return {
      com: document.getElementById('fComisaria').value,
      dis: document.getElementById('fDistrito').value,
      dia: document.getElementById('fDia').value,
      fra: document.getElementById('fFranja').value,
      confMin: Number(document.getElementById('fConf').value) || 0,
      usePts: document.getElementById('layerPuntos').checked,
      usePol: document.getElementById('layerPolys').checked,
      useHeat: document.getElementById('layerHeat').checked
    };
  }
  function passFilters(p, F){
    if (F.com && p.comisaria !== F.com) return false;
    if (F.dis && p.distrito !== F.dis)  return false;
    if (F.dia && p.dia !== F.dia)       return false;
    if (F.fra && p.franja !== F.fra)    return false;
    if ((p.confiabilidad||0) < F.confMin) return false;
    return true;
  }

  function render(points, polys){
    const F = getFilters();
    grupoPuntos.clearLayers();
    grupoPolys.clearLayers();
    if (heat){ map.removeLayer(heat); heat = null; }
    allFeatures = [];

    // Centroides
    if (F.usePts){
      for (const f of points.features){
        const p = f.properties||{};
        if (!passFilters(p,F)) continue;
        const [lng,lat] = f.geometry.coordinates;
        const marker = L.circleMarker([lat,lng], {
          radius: 7, color: colorByConf(p.confiabilidad), weight: 2, fillColor: colorByConf(p.confiabilidad), fillOpacity: .3
        }).bindPopup(popupHtml(p));
        marker.addTo(grupoPuntos);
        marker.bindTooltip(p.human_id || p.alerta_id || '', {direction:'top'});
        allFeatures.push([lat,lng]);

        L.circle([lat,lng], {radius: p.radio_m||300, color: colorByConf(p.confiabilidad), weight:1, opacity:.6, fill:false})
          .addTo(grupoPuntos);
      }
    }

    // Polígonos
    if (F.usePol){
      L.geoJSON(polys, {
        style: feat => ({ color: colorByConf((feat.properties||{}).confiabilidad), weight:2, fillOpacity:0.1 }),
        filter: feat => passFilters(feat.properties||{}, F),
        onEachFeature: (feat, layer)=> layer.bindPopup(popupHtml(feat.properties||{}))
      }).addTo(grupoPolys);
    }

    // Heatmap
    if (F.useHeat){
      const pts=[];
      for (const f of points.features){
        const p = f.properties||{};
        if (!passFilters(p,F)) continue;
        const [lng,lat] = f.geometry.coordinates;
        const w = Math.max(0.1, (p.confiabilidad||0)/100);
        pts.push([lat,lng,w]);
      }
      heat = L.heatLayer(pts, { radius:25, blur:15 }).addTo(map);
    }

    if (allFeatures.length){
      const bounds = L.latLngBounds(allFeatures);
      map.fitBounds(bounds, { padding:[20,20] });
    }
  }

  // Botón
  document.getElementById('btnFit').onclick = ()=> render(GJ_POINTS, GJ_POLYS);

  // Eventos de filtros
  ['fComisaria','fDistrito','fDia','fFranja','fConf','layerPuntos','layerPolys','layerHeat'].forEach(id=>{
    document.getElementById(id).addEventListener('input', ()=>{
      document.getElementById('confVal').textContent = document.getElementById('fConf').value;
      render(GJ_POINTS, GJ_POLYS);
    });
  });

  // Inicializar
  buildFilters(GJ_POINTS);
  render(GJ_POINTS, GJ_POLYS);
</script>
</body>
</html>